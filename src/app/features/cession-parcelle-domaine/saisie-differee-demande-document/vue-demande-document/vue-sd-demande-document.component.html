<mat-card>
    <mat-card-header>
        <mat-card-title>{{demandeDocument?.etat.libelle}}</mat-card-title>
        <mat-card-subtitle>{{demandeDocument?.etat.description}}</mat-card-subtitle>
        <ng-container *ngIf="demandeDocument && !noOpenActions && demandeDocument?.transitions?.length>0">
            <app-action-detail-dossier [numero]="demandeDocument.numero" [url]="urlAction" [transitions]="demandeDocument.transitions"></app-action-detail-dossier>
        </ng-container>
    </mat-card-header>
    <form class="user-form" *ngIf="demandeDocument">
        <mat-card-content>
            <mat-tab-group class="mat-tab-active-color">

                <mat-tab>
                    <form>
                        <ng-template mat-tab-label>
                            <mat-icon>content_paste</mat-icon>
                            Formalite
                        </ng-template>
                        <mat-tab-group>
                            <mat-tab>
                                <form>
                                    <ng-template mat-tab-label>
                                        <mat-icon>content_paste</mat-icon>
                                        Informations de base
                                    </ng-template>
                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Statut actif du dossier </mat-label>
                                            <input matInput value="{{demandeDocument.etatDossier | showBooleanValue}}" [readonly]="true">
                                        </mat-form-field>

                                    </div>

                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Numéro </mat-label>
                                            <input matInput value="{{demandeDocument.numeroDBT}}" [readonly]="true">
                                        </mat-form-field>
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Date dossier (*)</mat-label>
                                            <input matInput value="{{demandeDocument.dateDBT | date:'dd/MM/yyyy'}}" [readonly]="true">

                                        </mat-form-field>
                                    </div>
                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Objet </mat-label>
                                            <input matInput [attr.autocomplete]="'off'" value="{{demandeDocument.objet}}" [readonly]="true" />
                                        </mat-form-field>
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Date externe (*)</mat-label>
                                            <input matInput value="{{demandeDocument.dateExterne | date:'dd/MM/yyyy'}}" [readonly]="true">

                                        </mat-form-field>
                                    </div>

                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Référence externe </mat-label>
                                            <input matInput [attr.autocomplete]="'off'" value="{{demandeDocument.refExterne}}" [readonly]="true" />
                                        </mat-form-field>
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Valeur investissement </mat-label>
                                            <input matInput [attr.autocomplete]="'off'" value="{{demandeDocument.valeurInvestissement}}" [readonly]="true" />
                                        </mat-form-field>
                                    </div>

                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Numéro PV évaluation </mat-label>
                                            <input matInput [attr.autocomplete]="'off'" value="{{demandeDocument.numeroPVEvaluation}}" [readonly]="true" />
                                        </mat-form-field>
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Date évaluation </mat-label>
                                            <input matInput [attr.autocomplete]="'off'" value="{{demandeDocument.dateEvaluation | date:'dd/MM/yyyy'}}" [readonly]="true" />
                                        </mat-form-field>
                                    </div>

                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Numéro DBT </mat-label>
                                            <input matInput [attr.autocomplete]="'off'" value="{{demandeDocument.numeroDBT}}" [readonly]="true" />
                                        </mat-form-field>
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Date DBT </mat-label>
                                            <input matInput [attr.autocomplete]="'off'" value="{{demandeDocument.dateDBT | date:'dd/MM/yyyy'}}" [readonly]="true" />
                                        </mat-form-field>
                                    </div>
                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Statut actif du dossier </mat-label>
                                            <input matInput value="{{demandeDocument.etatDossier | showBooleanValue}}" [readonly]="true">
                                        </mat-form-field>
                                    </div>
                                </form>
                            </mat-tab>
                            <mat-tab>
                                <ng-template mat-tab-label>
                                    <mat-icon>attach_file</mat-icon>
                                    Pièces fournies
                                </ng-template>
                                <table mat-table [dataSource]="dataSourcePiece" class="mat-elevation-z8" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="90" [fxFlex.lg]="80" [fxFlex.xl]="70">
                                    <ng-container matColumnDef="categorie">
                                        <th mat-header-cell *matHeaderCellDef> Catégorie</th>
                                        <td mat-cell *matCellDef="let listPiece"> {{listPiece.categorie?.categoriePiece?.libelle}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="reference">
                                        <th mat-header-cell *matHeaderCellDef> Référence </th>
                                        <td mat-cell *matCellDef="let listPiece"> {{listPiece.reference}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="autorite">
                                        <th mat-header-cell *matHeaderCellDef> Autorité de délivrance </th>
                                        <td mat-cell *matCellDef="let listPiece"> {{listPiece.autoriteDeDelivrance}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="dateDelivrance">
                                        <th mat-header-cell *matHeaderCellDef> Date de délivrance </th>
                                        <td mat-cell *matCellDef="let listPiece"> {{listPiece.dateDelivrance | date: 'dd/MM/yyyy'}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="dateExpiration">
                                        <th mat-header-cell *matHeaderCellDef> Date d'expiration </th>
                                        <td mat-cell *matCellDef="let listPiece"> {{listPiece.dateExpiration| date: 'dd/MM/yyyy'}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="imageUrl">
                                        <th mat-header-cell *matHeaderCellDef> Pièce jointe </th>
                                        <td mat-cell *matCellDef="let listPiece">

                                          <span *ngIf="!listPiece.pieceJointe">Aucune pièce jointe</span>
                                          <ng-container *ngIf="listPiece.pieceJointe">
                                            <span *ngFor="let piece of listPiece.pieceJointe; let i = index"  class="piece-telechargeable"> <a   href="{{piece | generalDownload}}">Télécharger {{i+1}}</a></span>
                                          </ng-container>
                                      </td>
                                    </ng-container>
                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsPiece"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsPiece;"></tr>


                                </table>

                            </mat-tab>
                            <mat-tab>
                                <form>
                                    <ng-template mat-tab-label>
                                        <mat-icon>business</mat-icon>
                                        Structure
                                    </ng-template>
                                    <div fxLayout="row" fxLayout.sm="row wrap" fxLayout.xs="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">

                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="70" [fxFlex.lg]="50" [fxFlex.xl]="50">
                                            <mat-label>Structure</mat-label>
                                            <input matInput value="{{demandeDocument.transmission?.structure?.nom}}" [readonly]="true">
                                        </mat-form-field>

                                    </div>
                                    <div fxLayout="row" fxLayout.sm="row wrap" fxLayout.xs="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="70" [fxFlex.lg]="50" [fxFlex.xl]="50">
                                            <mat-label>Service</mat-label>
                                            <input matInput value="{{demandeDocument.transmission?.service?.nom}}" [readonly]="true">
                                        </mat-form-field>
                                    </div>
                                    <div fxLayout="row" fxLayout.sm="row wrap" fxLayout.xs="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="70" [fxFlex.lg]="50" [fxFlex.xl]="50">
                                            <mat-label>Bureau</mat-label>
                                            <input matInput value="{{demandeDocument.transmission?.bureau?.nom}}" [readonly]="true">
                                        </mat-form-field>
                                    </div>
                                </form>
                            </mat-tab>
                            <mat-tab>
                                <form>
                                    <ng-template mat-tab-label>
                                        <mat-icon>list_alt</mat-icon>
                                        Document de sortie
                                    </ng-template>
                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Libellé </mat-label>
                                            <input matInput value="{{demandeDocument.documentDeSortie.libelle}}" [readonly]="true">
                                        </mat-form-field>
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Numéro </mat-label>
                                            <input matInput value="{{demandeDocument.documentDeSortie.numero}}" [readonly]="true">
                                        </mat-form-field>

                                    </div>
                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">

                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Date document</mat-label>
                                            <input matInput value="{{demandeDocument.documentDeSortie.dateDoc | date:'dd/MM/yyyy'}}" [readonly]="true">

                                        </mat-form-field>
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Date validité</mat-label>
                                            <input matInput value="{{demandeDocument.documentDeSortie.dateValidite | date:'dd/MM/yyyy'}}" [readonly]="true">

                                        </mat-form-field>
                                    </div>
                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">

                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Type de document</mat-label>
                                            <input matInput value="{{demandeDocument.documentDeSortie?.documentType?.libelle}}" [readonly]="true">

                                        </mat-form-field>
                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Est titre parcelle</mat-label>
                                            <input matInput value="{{demandeDocument.documentDeSortie?.documentType?.estTitreParcelle | showBooleanValue}}" [readonly]="true">

                                        </mat-form-field>

                                    </div>
                                    <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">

                                        <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <mat-label>Est titre foncier</mat-label>
                                            <input matInput value="{{demandeDocument.documentDeSortie?.documentType?.estTitreFoncier | showBooleanValue}}" [readonly]="true">

                                        </mat-form-field>

                                        <div [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                            <span *ngIf="demandeDocument.documentDeSortie.pieceJointe"> <a href="{{demandeDocument.documentDeSortie.pieceJointe | generalDownload}}">Télécharger la pièce jointe</a></span>



                                        </div>
                                    </div>
                                </form>
                            </mat-tab>
                        </mat-tab-group>
                    </form>
                </mat-tab>

                <mat-tab>
                    <form>
                        <ng-template mat-tab-label>
                            <mat-icon>content_paste</mat-icon>
                            Propriété
                        </ng-template>
                        <mat-tab-group>
                            <mat-tab>
                                <form>
                                    <ng-template mat-tab-label>
                                        <mat-icon>list_alt</mat-icon>
                                        Parcelle
                                    </ng-template>

                                    <app-parcelle-visualiser [attribution]="demandeDocument"></app-parcelle-visualiser>

                                </form>
                                <app-cycledevie-parcelle [icad]="demandeDocument.parcelle?.icad"></app-cycledevie-parcelle>
                            </mat-tab>

                        </mat-tab-group>
                    </form>
                </mat-tab>

                <mat-tab>
                    <form>
                        <ng-template mat-tab-label>
                            <mat-icon>content_paste</mat-icon>
                            Contribuable
                        </ng-template>
                        <mat-tab-group>
                            <mat-tab *ngIf="demandeDocument.contribuableBeneficiaire">

                                <ng-template mat-tab-label>
                                    <mat-icon>person</mat-icon>
                                    Contribuable bénéficiaire
                                </ng-template>
                                <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                    <mat-card [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="80" [fxFlex.lg]="70" [fxFlex.xl]="60">
                                        <mat-card-header>
                                            <mat-card-title>
                                                Détail
                                            </mat-card-title>
                                        </mat-card-header>
                                        <mat-card-content>
                                            <app-card-general-contribuable-form [contribuable]="demandeDocument.contribuableBeneficiaire"></app-card-general-contribuable-form>
                                        </mat-card-content>
                                    </mat-card>
                                </div>
                            </mat-tab>
                            <mat-tab *ngIf="demandeDocument.structureBeneficiaire">
                                <ng-template mat-tab-label>
                                    <mat-icon>business</mat-icon>
                                    Structure bénéficiaire
                                </ng-template>
                                <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                    <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                        <mat-label>Code</mat-label>
                                        <input matInput value="{{demandeDocument.structureBeneficiaire.code}}" [readonly]="true">
                                    </mat-form-field>
                                    <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                        <mat-label>Nom</mat-label>
                                        <input matInput value="{{demandeDocument.structureBeneficiaire.nom}}" [readonly]="true">
                                    </mat-form-field>
                                </div>
                                <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                                    <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                        <mat-label>Type structure</mat-label>
                                        <input matInput value="{{demandeDocument.structureBeneficiaire?.typeStructure?.nom}}" [readonly]="true">
                                    </mat-form-field>
                                    <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                        <mat-label>Sigle</mat-label>
                                        <input matInput value="{{demandeDocument.structureBeneficiaire.sigle}}" [readonly]="true">
                                    </mat-form-field>
                                </div>

                            </mat-tab>

                            <mat-tab *ngIf="demandeDocument.contribuableBeneficiaire">
                                <ng-template mat-tab-label>
                                    <mat-icon>move_to_inbox</mat-icon>
                                    Mandats
                                </ng-template>
                                <table mat-table [dataSource]="dataSourceMandat" class="mat-elevation-z8" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="90" [fxFlex.lg]="80" [fxFlex.xl]="70">
                                    <ng-container matColumnDef="actif">
                                        <th mat-header-cell *matHeaderCellDef> Statut</th>
                                        <td mat-cell *matCellDef="let mandat"> {{mandat.actif | showBooleanValue}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="objet">
                                        <th mat-header-cell *matHeaderCellDef> Objet </th>
                                        <td mat-cell *matCellDef="let mandat"> {{mandat.objet}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="description">
                                        <th mat-header-cell *matHeaderCellDef> Description</th>
                                        <td mat-cell *matCellDef="let mandat"> {{mandat.description}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="reference">
                                        <th mat-header-cell *matHeaderCellDef> Référence</th>
                                        <td mat-cell *matCellDef="let mandat"> {{mandat.reference}} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="debut">
                                        <th mat-header-cell *matHeaderCellDef> Date de début </th>
                                        <td mat-cell *matCellDef="let mandat"> {{mandat.debut | date: 'dd/MM/yyyy'}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="fin">
                                        <th mat-header-cell *matHeaderCellDef> Date de fin </th>
                                        <td mat-cell *matCellDef="let mandat"> {{mandat.fin| date: 'dd/MM/yyyy'}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="mandataire">
                                        <th mat-header-cell *matHeaderCellDef> Mandataire</th>
                                        <td mat-cell *matCellDef="let mandat"> {{mandat.mandataire.libelle}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="pieceJointe">
                                        <th mat-header-cell *matHeaderCellDef> Pièce jointe </th>
                                        <td mat-cell *matCellDef="let mandat">
                                            <a *ngIf="mandat.pieceJointe" href="{{mandat.pieceJointe | generalDownload}}" target="_blank" color="primary">
                                    Télécharger</a>
                                            <span *ngIf="!mandat.pieceJointe">Aucune pièce jointe</span>

                                        </td>
                                    </ng-container>
                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsMandat"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsMandat;"></tr>

                                </table>
                            </mat-tab>

                        </mat-tab-group>
                    </form>
                </mat-tab>

                <mat-tab>
                    <form>
                        <ng-template mat-tab-label>
                            <mat-icon>content_paste</mat-icon>
                            Fiscalite
                        </ng-template>


                    </form>
                </mat-tab>


                <mat-tab>
                    <ng-template mat-tab-label>
                        <mat-icon>chrome_reader_mode</mat-icon>&nbsp;Historique
                    </ng-template>
                    <div fxLayout="row" fxLayoutAlign="start">
                        <div [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="60">
                            <app-historique [numero]="demandeDocument.numero"></app-historique>
                        </div>
                    </div>
                </mat-tab>
            </mat-tab-group>
        </mat-card-content>
    </form>
</mat-card>
