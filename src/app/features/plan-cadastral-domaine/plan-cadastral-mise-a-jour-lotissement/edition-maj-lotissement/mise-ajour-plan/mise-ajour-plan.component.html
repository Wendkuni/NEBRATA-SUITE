<form [formGroup]="formulaire">
    <mat-horizontal-stepper linear #stepper>

        <mat-step>
            <ng-template matStepLabel>Sections</ng-template>
            <mat-horizontal-stepper linear #stepper>
                <mat-step>
                    <ng-template matStepLabel>Sections à désactiver</ng-template>

                    <div fxLayout="row" fxLayout.lt-lg="row wrap" fxLayoutGap.sm="10px" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start center">
                        <table mat-table [dataSource]="dataSourceSectionsADesactiver" class="mat-elevation-z8 sycad-form-ng-select" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="90" [fxFlex.lg]="80" [fxFlex.xl]="70">
                            <ng-container matColumnDef="numero">
                                <th mat-header-cell *matHeaderCellDef> Numero </th>
                                <td mat-cell *matCellDef="let element"> {{element?.numero}} </td>
                            </ng-container>
                            <ng-container matColumnDef="numeroAncien">
                                <th mat-header-cell *matHeaderCellDef> Numero ancien</th>
                                <td mat-cell *matCellDef="let element"> {{element?.numeroAncien}} </td>
                            </ng-container>
                            <ng-container matColumnDef="commune">
                                <th mat-header-cell *matHeaderCellDef>Commune</th>
                                <td mat-cell *matCellDef="let element"> {{element?.commune.nom}}</td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumnsSection"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumnsSection;"></tr>
                        </table>
                    </div>
                    <div class="card-action-form">
                        <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                            <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                            <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                            <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                            <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                            <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                        </div>
                    </div>

                </mat-step>

                <mat-step>

                    <form [formGroup]="sectionsAAjouter">
                        <ng-template matStepLabel>Sections à ajouter</ng-template>
                        <div fxLayout="row" fxLayoutAlign="start">
                            <div class="form-table-ilot-container mat-elevation-z8">
                                <table mat-table [dataSource]="dataSourceSectionAjoute">

                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsSectionAjouter"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsSectionAjouter;"></tr>

                                    <ng-container matColumnDef="numeroAncien">
                                        <th mat-header-cell *matHeaderCellDef> Numero ancien</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="numeroAncien">
                                            </mat-form-field>

                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="commune" sticky>
                                        <th mat-header-cell *matHeaderCellDef> Commune </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="communeRemoteAutocomplete.listRessource$ | async" [typeahead]="communeRemoteAutocomplete.term" [loading]="communeRemoteAutocomplete.loading" (search)="onSearchCommune($event)" appendTo="body" [selectOnTab]="true" bindLabel="nom" bindValue="id"
                                                    placeholder="Commune(*)" formControlName="commune">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>

                                            </div>
                                        </td>
                                    </ng-container>

                                </table>
                            </div>
                        </div>


                        <div class="card-action-form">
                            <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                                <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                                <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                                <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                                <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                                <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                            </div>
                        </div>
                    </form>

                </mat-step>
                <mat-step>
                    <form [formGroup]="sectionsAModifier">
                        <ng-template matStepLabel>Sections à modifier</ng-template>

                        <div fxLayout="row" fxLayoutAlign="start">
                            <div class="form-table-ilot-container mat-elevation-z8">
                                <table mat-table [dataSource]="dataSourceSectioneModifie">

                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsSection"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsSection;"></tr>

                                    <ng-container matColumnDef="numero" sticky>
                                        <th mat-header-cell *matHeaderCellDef> Numéro </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="numero">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="numeroAncien">
                                        <th mat-header-cell *matHeaderCellDef> Numero ancien</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="numeroAncien">
                                            </mat-form-field>

                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="commune" sticky>
                                        <th mat-header-cell *matHeaderCellDef> Commune </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="commune">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                </table>
                            </div>
                        </div>

                        <div class="card-action-form">
                            <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                                <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                                <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                                <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                                <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                                <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                            </div>
                        </div>
                    </form>

                </mat-step>
            </mat-horizontal-stepper>
        </mat-step>


        <mat-step>
            <ng-template matStepLabel>Ilots</ng-template>
            <mat-horizontal-stepper linear #stepper>
                <mat-step>
                    <ng-template matStepLabel>Ilots à désactiver</ng-template>

                    <div fxLayout="row" fxLayout.lt-lg="row wrap" fxLayoutGap.sm="10px" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start center">
                        <table mat-table [dataSource]="dataSourceIlotADesactiver" class="mat-elevation-z8 sycad-form-ng-select" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="90" [fxFlex.lg]="80" [fxFlex.xl]="70">
                            <ng-container matColumnDef="numero">
                                <th mat-header-cell *matHeaderCellDef> Numero </th>
                                <td mat-cell *matCellDef="let element"> {{element?.numero}} </td>
                            </ng-container>
                            <ng-container matColumnDef="numeroAncien">
                                <th mat-header-cell *matHeaderCellDef> Numero ancien</th>
                                <td mat-cell *matCellDef="let element"> {{element?.numeroAncien}} </td>
                            </ng-container>

                            <ng-container matColumnDef="section">
                                <th mat-header-cell *matHeaderCellDef>Numéro section</th>
                                <td mat-cell *matCellDef="let element"> {{element?.section?.numero}}</td>
                            </ng-container>

                            <ng-container matColumnDef="commune">
                                <th mat-header-cell *matHeaderCellDef>Commune</th>
                                <td mat-cell *matCellDef="let element"> {{element?.section?.commune?.nom}}</td>
                            </ng-container>


                            <tr mat-header-row *matHeaderRowDef="displayedColumnsIlot"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumnsIlot;"></tr>
                        </table>
                    </div>

                    <div class="card-action-form">
                        <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                            <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                            <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                            <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                            <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                            <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                        </div>
                    </div>

                </mat-step>

                <mat-step>

                    <form [formGroup]="ilotsAAjouter">
                        <ng-template matStepLabel>Ilots à ajouter</ng-template>

                        <div fxLayout="row" fxLayoutAlign="start">
                            <div class="form-table-ilot-container mat-elevation-z8">
                                <table mat-table [dataSource]="dataSourceIlotAjoute">


                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsIlotAjouter"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsIlotAjouter;"></tr>

                                    <ng-container matColumnDef="numero" sticky>
                                        <th mat-header-cell *matHeaderCellDef> Numéro </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="numero">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="numeroAncien">
                                        <th mat-header-cell *matHeaderCellDef> Numéro ancien </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">

                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="numeroAncien">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="section" sticky>
                                        <th mat-header-cell *matHeaderCellDef> Section </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="sectionRemoteAutocomplete.listRessource$ | async" [typeahead]="sectionRemoteAutocomplete.term" [loading]="sectionRemoteAutocomplete.loading" (search)="onSearchSection($event)" appendTo="body" [selectOnTab]="true" bindLabel="numero"
                                                    bindValue="id" placeholder="Section (*)" formControlName="section">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>

                                            </div>
                                        </td>
                                    </ng-container>

                                </table>
                            </div>
                        </div>

                        <div class="card-action-form">
                            <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                                <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                                <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                                <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                                <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                                <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                            </div>
                        </div>
                    </form>




                </mat-step>

                <mat-step>
                    <form [formGroup]="ilotsAModifier">

                        <ng-template matStepLabel>Ilots à modifier</ng-template>
                        <div fxLayout="row" fxLayoutAlign="start">
                            <div class="form-table-ilot-container mat-elevation-z8">
                                <table mat-table [dataSource]="dataSourceIlotModifie">


                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsIlot"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsIlot;"></tr>

                                    <ng-container matColumnDef="numero" sticky>
                                        <th mat-header-cell *matHeaderCellDef> Numéro </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="numero">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="numeroAncien">
                                        <th mat-header-cell *matHeaderCellDef> Numéro ancien </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">

                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="numeroAncien">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                </table>
                            </div>
                        </div>

                        <div class="card-action-form">
                            <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                                <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                                <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                                <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                                <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                                <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                            </div>
                        </div>

                    </form>


                </mat-step>
            </mat-horizontal-stepper>
        </mat-step>

        <mat-step>
            <ng-template matStepLabel>Parcelles</ng-template>
            <mat-horizontal-stepper linear #stepper>
                <mat-step>
                    <ng-template matStepLabel>Parcelles à désactiver</ng-template>
                    <div fxLayout="row" fxLayout.lt-lg="row wrap" fxLayoutGap.sm="10px" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start center">
                        <table mat-table [dataSource]="dataSourceParcellesADesactiver" class="mat-elevation-z8 sycad-form-ng-select" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="90" [fxFlex.lg]="80" [fxFlex.xl]="70">
                            <ng-container matColumnDef="numero">
                                <th mat-header-cell *matHeaderCellDef> Numero </th>
                                <td mat-cell *matCellDef="let element"> {{element?.numero}} </td>
                            </ng-container>
                            <ng-container matColumnDef="numeroAncien">
                                <th mat-header-cell *matHeaderCellDef> Numero ancien</th>
                                <td mat-cell *matCellDef="let element"> {{element?.numeroAncien}} </td>
                            </ng-container>
                            <ng-container matColumnDef="libelle">
                                <th mat-header-cell *matHeaderCellDef>libelle</th>
                                <td mat-cell *matCellDef="let element"> {{element?.libelle}}</td>
                            </ng-container>

                            <ng-container matColumnDef="superficie">
                                <th mat-header-cell *matHeaderCellDef>Superficie</th>
                                <td mat-cell *matCellDef="let element"> {{element?.superficie}}</td>
                            </ng-container>

                            <ng-container matColumnDef="destination">
                                <th mat-header-cell *matHeaderCellDef>Destination</th>
                                <td mat-cell *matCellDef="let element"> {{element?.destination?.libelle}}</td>
                            </ng-container>

                            <ng-container matColumnDef="arrondissement">
                                <th mat-header-cell *matHeaderCellDef>Arrondissement</th>
                                <td mat-cell *matCellDef="let element"> {{element?.arrondissement?.nom}}</td>
                            </ng-container>

                            <ng-container matColumnDef="localite">
                                <th mat-header-cell *matHeaderCellDef>Localité</th>
                                <td mat-cell *matCellDef="let element"> {{element?.localite?.nom}}</td>
                            </ng-container>


                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                        </table>
                    </div>

                    <div class="card-action-form">
                        <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                            <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                            <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                            <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                            <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                            <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                        </div>
                    </div>

                </mat-step>
                <mat-step>
                    <form [formGroup]="parcellesAAjouter" class="form-container">
                        <ng-template matStepLabel>Parcelles à ajouter</ng-template>
                        <div fxLayout="row" fxLayoutAlign="start">
                            <!--div fxLayout="row" fxLayout.lt-lg="row wrap" fxLayoutGap.sm="10px" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start center"-->
                            <div class="form-table-ilot-container mat-elevation-z8">
                                <table mat-table [dataSource]="dataSourceParcelleAAjoute">

                                    <ng-container matColumnDef="ilot">
                                        <th mat-header-cell *matHeaderCellDef> Choisir Ilot </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select class="ilotField" [items]="ilotRemoteAutocomplete.listRessource$ | async" [typeahead]="ilotRemoteAutocomplete.term" [loading]="ilotRemoteAutocomplete.loading" (search)="onSearchIlot($event)" appendTo="body" formControlName="ilot" [selectOnTab]="true"
                                                    bindLabel="nom" bindValue="id" placeholder="Ilot">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                    <ng-template ng-label-tmp let-item="item">
                                                        <span *ngIf="item.numeroAncien"> Numéro ancien : </span>
                                                        <span *ngIf="item.numeroAncien">{{item.numeroAncien}}</span> <span *ngIf="item.numeroAncien"> --
                  </span> Numéro : <span>{{item.numero}}</span>
                                                    </ng-template>
                                                    <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                                                        <span *ngIf="item.numeroAncien"> Numéro ancien : </span>
                                                        <span *ngIf="item.numeroAncien" [ngOptionHighlight]="search">{{item.numeroAncien}}</span> <span *ngIf="item.numeroAncien"> -- </span> Numéro : <span [ngOptionHighlight]="search">{{item.numero}}</span>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>

                                    </ng-container>

                                    <ng-container matColumnDef="numeroAncien">
                                        <th mat-header-cell *matHeaderCellDef> Numero ancien</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput formControlName="numeroAncien">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="libelle">
                                        <th mat-header-cell *matHeaderCellDef>libelle</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput formControlName="libelle">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="superficie">
                                        <th mat-header-cell *matHeaderCellDef>Superficie</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput formControlName="superficie">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="destination">
                                        <th mat-header-cell *matHeaderCellDef>Destination</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="destinationRemoteAutocomplete.listRessource$ | async" [typeahead]="destinationRemoteAutocomplete.term" [loading]="destinationRemoteAutocomplete.loading" (search)="onSearchDestination($event)" appendTo="body" [selectOnTab]="true" bindLabel="libelle"
                                                    bindValue="id" placeholder="Destination(*)" formControlName="destination">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>

                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="arrondissement">
                                        <th mat-header-cell *matHeaderCellDef>Arrondissement</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">

                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="arrondissementRemoteAutocomplete.listRessource$ | async" [groupBy]="groupByFnArrondissement" [groupValue]="groupValueFnArrondissement" [loading]="arrondissementRemoteAutocomplete.loading" (search)="onSearchArrondissement($event)" appendTo="body"
                                                    [selectOnTab]="true" bindLabel="nom" bindValue="id" placeholder="Arrondissement (*)" formControlName="arrondissement">
                                                    <ng-template ng-optgroup-tmp let-item="item">
                                                        <span style="vertical-align: middle;"> {{item.name}}</span>
                                                    </ng-template>
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                    <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                                        <div class="ng-value" *ngFor="let arrondissement of items | slice:0:5">
                                                            <span class="ng-value-icon right" (click)="clear(arrondissement)" aria-hidden="true">× </span>
                                                            <span class="ng-value-label"> {{arrondissement.nom}}</span>

                                                        </div>
                                                        <div class="ng-value" *ngIf="items.length > 5">
                                                            <span class="ng-value-label">{{items.length - 5}} plus...</span>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="localite">
                                        <th mat-header-cell *matHeaderCellDef>Localité</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="localiteRemoteAutocomplete.listRessource$ | async" [typeahead]="localiteRemoteAutocomplete.term" [loading]="localiteRemoteAutocomplete.loading" (search)="onSearchLocalite($event)" appendTo="body" [selectOnTab]="true" bindLabel="nom"
                                                    bindValue="id" placeholder="Localité (*)" formControlName="localite">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="quartier">
                                        <th mat-header-cell *matHeaderCellDef> quartier </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="quartierRemoteAutocomplete.listRessource$ | async" [typeahead]="quartierRemoteAutocomplete.term" [loading]="quartierRemoteAutocomplete.loading" (search)="onSearchQuartier($event)" appendTo="body" [selectOnTab]="true" bindLabel="nom"
                                                    bindValue="id" placeholder="Quartier " formControlName="quartier">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="zone">
                                        <th mat-header-cell *matHeaderCellDef> Arrondissement zone </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select appendTo="body" [selectOnTab]="true" bindLabel="libelle" bindValue="id" placeholder="Zone d'arrondissement " formControlName="zone">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>
                                    </ng-container>


                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsAjouter"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsAjouter;"></tr>
                                </table>
                            </div>

                        </div>

                        <div class="card-action-form">
                            <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                                <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                                <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                                <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                                <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                                <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                            </div>
                        </div>
                    </form>
                </mat-step>
                <mat-step>
                    <form [formGroup]="parcellesAModifier">
                        <ng-template matStepLabel>Parcelles à modifier</ng-template>
                        <div fxLayout="row" fxLayoutAlign="start">
                            <div class="form-table-ilot-container mat-elevation-z8">
                                <table mat-table [dataSource]="dataSourceParcelleModifie">
                                    <ng-container matColumnDef="numero">
                                        <th mat-header-cell *matHeaderCellDef> Numero </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput formControlName="numero">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="numeroAncien">
                                        <th mat-header-cell *matHeaderCellDef> Numero ancien</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput formControlName="numeroAncien">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="libelle">
                                        <th mat-header-cell *matHeaderCellDef> libelle </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput [attr.autocomplete]="'off'" formControlName="libelle">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="superficie">
                                        <th mat-header-cell *matHeaderCellDef>Superficie</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <mat-form-field appearance="outline">
                                                <input matInput formControlName="superficie">
                                            </mat-form-field>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="destination">
                                        <th mat-header-cell *matHeaderCellDef>Destination</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="destinationRemoteAutocompleteAdd.listRessource$ | async" [typeahead]="destinationRemoteAutocomplete.term" [loading]="destinationRemoteAutocompleteAdd.loading" (search)="onSearchDestinationEdit($event)" appendTo="body" [selectOnTab]="true"
                                                    bindLabel="libelle" bindValue="id" placeholder="Destination(*)" formControlName="destination">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>

                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="arrondissement">
                                        <th mat-header-cell *matHeaderCellDef>Arrondissement</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">

                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="arrondissementRemoteAutocompleteAdd.listRessource$ | async" [groupBy]="groupByFnArrondissement" [groupValue]="groupValueFnArrondissement" [loading]="arrondissementRemoteAutocompleteAdd.loading" (search)="onSearchArrondissementAdd($event)"
                                                    appendTo="body" [selectOnTab]="true" bindLabel="nom" bindValue="id" placeholder="Arrondissement (*)" formControlName="arrondissement">
                                                    <ng-template ng-optgroup-tmp let-item="item">
                                                        <span style="vertical-align: middle;"> {{item.name}}</span>
                                                    </ng-template>
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                    <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                                        <div class="ng-value" *ngFor="let arrondissement of items | slice:0:5">
                                                            <span class="ng-value-icon right" (click)="clear(arrondissement)" aria-hidden="true">× </span>
                                                            <span class="ng-value-label"> {{arrondissement.nom}}</span>

                                                        </div>
                                                        <div class="ng-value" *ngIf="items.length > 5">
                                                            <span class="ng-value-label">{{items.length - 5}} plus...</span>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="localite">
                                        <th mat-header-cell *matHeaderCellDef>Localité</th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="localiteRemoteAutocompleteAdd.listRessource$ | async" [typeahead]="localiteRemoteAutocomplete.term" [loading]="localiteRemoteAutocompleteAdd.loading" (search)="onSearchLocaliteAdd($event)" appendTo="body" [selectOnTab]="true" bindLabel="nom"
                                                    bindValue="id" placeholder="Localité (*)" formControlName="localite">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="quartier">
                                        <th mat-header-cell *matHeaderCellDef> quartier </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select [items]="quartierRemoteAutocompleteAdd.listRessource$ | async" [typeahead]="quartierRemoteAutocomplete.term" [loading]="quartierRemoteAutocompleteAdd.loading" (search)="onSearchQuartierAdd($event)" appendTo="body" [selectOnTab]="true" bindLabel="nom"
                                                    bindValue="id" placeholder="Quartier " formControlName="quartier">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="zone">
                                        <th mat-header-cell *matHeaderCellDef> Arrondissement zone </th>
                                        <td mat-cell *matCellDef="let element" [formGroup]="element">
                                            <div class="sycad-form-ng-select-in-table">
                                                <ng-select appendTo="body" [selectOnTab]="true" bindLabel="libelle" bindValue="id" placeholder="Zone d'arrondissement " formControlName="zone">
                                                    <ng-template ng-loadingspinner-tmp>
                                                        <div class="lds-ellipsis">
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                            <div></div>
                                                        </div>
                                                    </ng-template>
                                                </ng-select>
                                            </div>
                                        </td>
                                    </ng-container>


                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsModifier"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsModifier;"></tr>
                                </table>
                            </div>
                        </div>

                        <div class="card-action-form">
                            <div fxLayout="row" [fxLayoutGap]="'20px'" fxLayoutAlign="end center">
                                <button mat-raised-button type="button" mat-button (click)="stepper.reset()">Reinitialiser</button>
                                <button mat-raised-button color="warn" (click)="resetForm()" type="button">Annuler</button>
                                <button mat-raised-button type="button" mat-button matStepperPrevious>Précédent</button>
                                <button mat-raised-button color="primary" type="button" matStepperNext>Suivant</button>
                                <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" [disabled]="!formulaire.valid">{{transition?.libelle}}</button>
                            </div>
                        </div>
                    </form>

                </mat-step>
            </mat-horizontal-stepper>
        </mat-step>


    </mat-horizontal-stepper>

</form>