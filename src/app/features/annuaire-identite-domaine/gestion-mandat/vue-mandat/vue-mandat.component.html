<mat-card *ngIf="mandat">
    <mat-card-header>
        <mat-card-title>{{mandat?.etat.libelle}}</mat-card-title>
        <mat-card-subtitle>{{mandat?.etat.description}}</mat-card-subtitle>
        <ng-container *ngIf="mandat && !noOpenActions && mandat?.transitions?.length>0">
            <app-action-detail-dossier [numero]="mandat.numero" [url]="urlAction" [transitions]="mandat.transitions"></app-action-detail-dossier>
        </ng-container>
    </mat-card-header>
    <form class="user-form">
        <mat-card-content>
            <mat-tab-group>
                <mat-tab>
                    <form>
                        <ng-template mat-tab-label>
                            <mat-icon>content_paste</mat-icon>
                           Informations de base
                        </ng-template>
                        <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Numéro </mat-label>
                                <input matInput placeholder="Date de création" value="{{mandat.numero}}" [readonly]="true">
                            </mat-form-field>
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Date dossier (*)</mat-label>
                                <input matInput value="{{mandat.dateCreationDossier | date:'dd/MM/yyyy'}}" [readonly]="true">

                            </mat-form-field>
                        </div>
                        <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Objet </mat-label>
                                <input matInput [attr.autocomplete]="'off'" value="{{mandat.objet}}" [readonly]="true" />
                            </mat-form-field>
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Date externe (*)</mat-label>
                                <input matInput placeholder="Date de création" value="{{mandat.dateExterne | date:'dd/MM/yyyy'}}" [readonly]="true">

                            </mat-form-field>
                        </div>

                        <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Référence externe </mat-label>
                                <input matInput [attr.autocomplete]="'off'" value="{{mandat.refExterne}}" [readonly]="true" />
                            </mat-form-field>

                                <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                    <mat-label>Statut actif du dossier </mat-label>
                                    <input matInput value="{{mandat.etatDossier | showBooleanValue}}" [readonly]="true">
                                </mat-form-field>

                        </div>
                        <div fxLayout="row" fxLayout.sm="row wrap" fxLayout.md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">

                        </div>

                        <div fxLayout="row" fxLayout.sm="row wrap" fxLayout.md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">

                        </div>
                    </form>
                </mat-tab>

                <mat-tab>
                    <form>
                        <ng-template mat-tab-label>
                            <mat-icon>content_paste</mat-icon>
                            Infos du mandat
                        </ng-template>
                        <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Objet </mat-label>
                                <input matInput [attr.autocomplete]="'off'" value="{{mandat.mandat.objet}}" [readonly]="true" />
                            </mat-form-field>
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Date externe (*)</mat-label>
                                <input matInput value="{{mandat.dateExterne | date:'dd/MM/yyyy'}}" [readonly]="true">

                            </mat-form-field>
                        </div>

                        <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Référence </mat-label>
                                <input matInput [attr.autocomplete]="'off'" value="{{mandat?.mandat?.reference}}" [readonly]="true" />
                            </mat-form-field>
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Description</mat-label>
                                <input matInput [attr.autocomplete]="'off'" value="{{mandat?.mandat?.description}}" [readonly]="true" />
                            </mat-form-field>
                        </div>

                        <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Date début</mat-label>
                                <input matInput value="{{mandat?.mandat?.debut | date:'dd/MM/yyyy'}}" [readonly]="true">

                            </mat-form-field>
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="45" [fxFlex.lg]="25" [fxFlex.xl]="20">
                                <mat-label>Date fin</mat-label>
                                <input matInput value="{{mandat?.mandat?.fin | date:'dd/MM/yyyy'}}" [readonly]="true">
                            </mat-form-field>
                        </div>


                        <div fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <a *ngIf="mandat?.mandat?.pieceJointe" href="{{mandat?.mandat?.pieceJointe | generalDownload}}" target="_blank" color="primary">
                  Télécharger</a>
                            <span *ngIf="!mandat?.mandat?.pieceJointe">Aucune pièce jointe</span>

                        </div>
                    </form>
                </mat-tab>


                <mat-tab>

                    <ng-template mat-tab-label>
                        <mat-icon>business</mat-icon>
                        Mandataire
                    </ng-template>
                    <!-- Affiche les information du carde mandataire -->
                    <div *ngIf="mandat?.mandat?.mandataire" fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                        <mat-card [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="100" [fxFlex.xl]="100">
                            <mat-card-header>
                                <mat-card-title>
                                    Détail mandataire
                                </mat-card-title>
                            </mat-card-header>
                            <mat-card-content>
                                <app-card-general-contribuable-form [contribuable]="mandat?.mandat?.mandataire"></app-card-general-contribuable-form>
                            </mat-card-content>
                        </mat-card>
                    </div>
                </mat-tab>
                <mat-tab>

                    <ng-template mat-tab-label>
                        <mat-icon>business</mat-icon>
                        Mandant
                    </ng-template>
                    <!-- Affiche les information du carde mandataire -->
                    <div *ngIf="mandat?.mandat?.mandant" fxLayout="row" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                        <mat-card [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="100" [fxFlex.xl]="100">
                            <mat-card-header>
                                <mat-card-title>
                                    Détail mandant
                                </mat-card-title>
                            </mat-card-header>
                            <mat-card-content>
                                <app-card-general-contribuable-form [contribuable]="mandat?.mandat?.mandant"></app-card-general-contribuable-form>
                            </mat-card-content>
                        </mat-card>
                    </div>
                </mat-tab>
                <mat-tab>
                    <ng-template mat-tab-label>
                        <mat-icon>attach_file</mat-icon>
                        Pièces fournies
                    </ng-template>
                    <table mat-table [dataSource]="dataSourcePiece" class="mat-elevation-z8" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="90" [fxFlex.lg]="80" [fxFlex.xl]="70">
                        <ng-container matColumnDef="categorie">
                            <th mat-header-cell *matHeaderCellDef> Catégorie</th>
                            <td mat-cell *matCellDef="let listPiece"> {{listPiece.categorie?.categoriePiece?.libelle}} </td>
                        </ng-container>
                        <ng-container matColumnDef="reference">
                            <th mat-header-cell *matHeaderCellDef> Référence </th>
                            <td mat-cell *matCellDef="let listPiece"> {{listPiece.reference}} </td>
                        </ng-container>
                        <ng-container matColumnDef="autorite">
                            <th mat-header-cell *matHeaderCellDef> Autorité de délivrance </th>
                            <td mat-cell *matCellDef="let listPiece"> {{listPiece.autoriteDeDelivrance}} </td>
                        </ng-container>
                        <ng-container matColumnDef="dateDelivrance">
                            <th mat-header-cell *matHeaderCellDef> Date de délivrance </th>
                            <td mat-cell *matCellDef="let listPiece"> {{listPiece.dateDelivrance | date: 'dd/MM/yyyy'}} </td>
                        </ng-container>
                        <ng-container matColumnDef="dateExpiration">
                            <th mat-header-cell *matHeaderCellDef> Date d'expiration </th>
                            <td mat-cell *matCellDef="let listPiece"> {{listPiece.dateExpiration| date: 'dd/MM/yyyy'}} </td>
                        </ng-container>
                        <ng-container matColumnDef="imageUrl">
                            <th mat-header-cell *matHeaderCellDef> Pièce jointe </th>
                            <td mat-cell *matCellDef="let listPiece">

                              <span *ngIf="!listPiece.pieceJointe">Aucune pièce jointe</span>
                              <ng-container *ngIf="listPiece.pieceJointe">
                                <span *ngFor="let piece of listPiece.pieceJointe; let i = index"  class="piece-telechargeable"> <a   href="{{piece | generalDownload}}">Télécharger {{i+1}}</a></span>
                              </ng-container>
                          </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="displayedColumnsPiece"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumnsPiece;"></tr>


                    </table>

                </mat-tab>

                <mat-tab>
                    <form>
                        <ng-template mat-tab-label>
                            <mat-icon>business</mat-icon>
                            Structure
                        </ng-template>
                        <div fxLayout="row" fxLayout.sm="row wrap" fxLayout.xs="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">

                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="70" [fxFlex.lg]="50" [fxFlex.xl]="50">
                                <mat-label>Structure</mat-label>
                                <input matInput value="{{mandat.transmission?.structure?.nom}}" [readonly]="true">
                            </mat-form-field>

                        </div>
                        <div fxLayout="row" fxLayout.sm="row wrap" fxLayout.xs="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="70" [fxFlex.lg]="50" [fxFlex.xl]="50">
                                <mat-label>Service</mat-label>
                                <input matInput value="{{mandat.transmission?.service?.nom}}" [readonly]="true">
                            </mat-form-field>
                        </div>
                        <div fxLayout="row" fxLayout.sm="row wrap" fxLayout.xs="row wrap" fxLayoutGap.gt-sm="20px" fxLayoutAlign="start">
                            <mat-form-field class="sycad-form-line" appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="70" [fxFlex.lg]="50" [fxFlex.xl]="50">
                                <mat-label>Bureau</mat-label>
                                <input matInput value="{{mandat.transmission?.bureau?.nom}}" [readonly]="true">
                            </mat-form-field>
                        </div>
                    </form>
                </mat-tab>





                <mat-tab>
                    <ng-template mat-tab-label>
                        <mat-icon>chrome_reader_mode</mat-icon>&nbsp;Historique
                    </ng-template>
                    <div fxLayout="row" fxLayoutAlign="start">
                        <div [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="60">
                            <app-historique [numero]="mandat?.numero"></app-historique>
                        </div>

                    </div>
                </mat-tab>
            </mat-tab-group>
        </mat-card-content>
    </form>
</mat-card>
